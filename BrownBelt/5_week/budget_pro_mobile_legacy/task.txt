Задание по программированию: Личный бюджет, professional mobile legacy version

В прошлой задаче вы модифицировали хорошо структурированный код базовой (home) функциональности Личного бюджета. 
Здесь же вам предстоит реализовать ту же функциональность (professional), но на основе менее понятного кода:

Эта задача демонстрирует, насколько проще дорабатывать аккуратно написанный код, даже если его основная идея вам 
незнакома. Тем не менее, если ранее вы уже реализовывали алгоритм, используемый в этой задаче, более короткий код 
покажется вам не таким уж и непонятным.

О тестировании
Современные компиляторы достаточно хорошо оптимизируют код, поэтому legacy-версия не оказывается быстрее предыдущей, 
более громоздкой, версии.

Чтобы вы не могли сдать в эту задачу решение предыдущей, код будет компилироваться без оптимизаций: как следствие, 
решение предыдущей задачи здесь не уложится в ограничения по времени (3 секунды). Поскольку это ограничение довольно 
жёсткое, а реальное время работы программы может варьироваться в зависимости от текущей нагрузки на тестирующий 
сервер, с небольшой вероятностью даже правильное решение может не уложиться в ограничения по времени — в этом случае 
мы советуем вам переотправить решение.
